<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="490" height="220" creationComplete="initApp()">
	
	<mx:Metadata>
		[Event(name="enviaDispersion", type="Data.EventDispersion")]
	</mx:Metadata>
	
	<mx:NumberValidator id="montoV" source="{txtMonto}" property="text" decimalSeparator="."
	thousandsSeparator="," triggerEvent="" invalid="{txtMonto.setFocus()}" 
	decimalPointCountError="Capture correctamente la cantidad" precision="2" 
	precisionError="Capture correctamente la cantidad" required="false"/>
	
	<mx:Validator id="referenciaV" source="{txtReferencia}" property="text" 
	 invalid="{txtReferencia.setFocus()}" triggerEvent="" requiredFieldError="Dato Requerido"/>
	
	<mx:Validator id="conceptoV" source="{txtConcepto}" property="text" 
	invalid="{txtConcepto.setFocus()}" triggerEvent="" requiredFieldError="Dato Requerido"/>
	
	<mx:Validator id="supV" source="{txtSup}" property="text" 
	invalid="{txtSup.setFocus()}" triggerEvent="" requiredFieldError="Dato Requerido"/>

	<mx:Script>
		<![CDATA[
			import Data.DatosDispersion;
			import Data.EventDispersion;
			import Data.Globales;
			import Data.Utils;
			import OPERAC.MttoBusqSup;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.core.Application;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.soap.WebService;
			import mx.validators.Validator;
			
			private var global:Globales;
			private var du:Utils;
			private var titulo:String;
			private var codFid:String;
			private var codSup:String;
			
			public var _xmlBanco:XML = new XML();
			
			public var bancoObj:ArrayCollection = new ArrayCollection();
			
			private function initApp():void{
				var wsCat:WebService = new WebService;
				var params:Array = new Array;
				
				global = new Globales();
				du = new Utils();
				titulo = "Registro de Transferencia";
				
				du.initWsCat(wsCat);
				du.sCursor();
				
				du.ejecutaWsMethod(wsCat,function(evt:ResultEvent):void {											
					_xmlBanco = new XML(evt.result);
					
					du.rCursor();
					du.closeWs(wsCat);	
					
					if (_xmlBanco.elements().length() > 0){
						formateaBanco();
						cboBanco.dataProvider = bancoObj;
					}		
				});
				wsCat.getCatalogoGral.send(38, params);	
			}
			
			public function enviaTransferencia(formData:DatosDispersion):void{
				var invalidArray:Array = Validator.validateAll([conceptoV, montoV, supV]);
				
				if(invalidArray.length == 0){	
					formData.cdgMetodo = "T";
					formData.cdgBanco = cboBanco.selectedItem.id;
					formData.cuenta = txtReferencia.text;
					formData.concepto = txtConcepto.text;
					formData.monto = Number(txtMonto.text);
					formData.fecha = dtfFecha.text;
					formData.cdgMotivo = "DE";
					formData.cdgFid = codFid;
					formData.cdgSup = codSup;
					formData.reportado = "N";
					formData.guarda = true;	
				}
				else
					formData.guarda = false;
			}
			
			private function formateaBanco():void{
				var cont:int = _xmlBanco.elements().length();
				var oItem:Object;
				var item:Array = new Array;
				
				oItem = new Object();
				oItem.id = "0";
				oItem.nombre = "--Seleccionar--";
				item.push(oItem);
				
				for (var i:int = 0; i < cont; i++){
					oItem = new Object();
					oItem.id = _xmlBanco.Table[i].CODIGO;	
					oItem.nombre = _xmlBanco.Table[i].NOMBRE;
					item.push(oItem);
				}
				bancoObj = new ArrayCollection(item);
			}
			
			private function mostrarFormSup():void{
				var comBusqSup:MttoBusqSup = new MttoBusqSup;
				comBusqSup = MttoBusqSup(PopUpManager.createPopUp(this,MttoBusqSup,true));
				comBusqSup.addEventListener("enviar", seleccionarSup); 
				PopUpManager.centerPopUp(comBusqSup);
			}
			
			private function seleccionarSup(evt:Event):void{
				var comBusqSup:MttoBusqSup = evt.currentTarget as MttoBusqSup;
				codFid = comBusqSup.obtenerFid();
				codSup = comBusqSup.obtenerSup();
				txtSup.text = comBusqSup.obtenerClaveSup();
			}
	]]>
	</mx:Script>
	<mx:Label id="lblBanco" x="78" y="13" text="Banco:"/>
	<mx:ComboBox id="cboBanco" labelField="nombre" width="189" x="125" y="10"/>
	<mx:Label id="lblReferencia" x="82" y="43" text="Clabe:"/>
	<mx:TextInput id="txtReferencia" maxChars="18" width="150" x="125" y="42"/>
	<mx:Label id="lblConcepto" x="63" y="73" text="Concepto:"/>
	<mx:TextArea id="txtConcepto" maxChars="30" width="300" x="125" y="72"/>
	<mx:Label id="lblMonto" x="80" y="125" text="Monto:"/>
	<mx:TextInput id="txtMonto" maxChars="12" width="82" restrict="0-9\." x="125" y="124"/>
	<mx:Label id="lblFecha" x="79" y="155" text="Fecha:"/>
	<mx:DateField id="dtfFecha" width="100" x="125" y="154"/>
	<mx:Label id="lblSup" x="53" y="185" text="Suplemento:"/>
	<mx:TextInput id="txtSup" editable="false" width="300" x="125" y="184"/>
	<mx:Button id="btnSup" x="433" y="183" width="40" icon="@Embed(source='assets/ico_lupa.png')" click="mostrarFormSup()"/>
</mx:Canvas>