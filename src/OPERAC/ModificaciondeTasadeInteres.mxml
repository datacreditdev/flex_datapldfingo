<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="280" height="200" backgroundAlpha="1.0" 
	backgroundColor="#FFFFFF" creationPolicy="all" creationComplete="initApp()" 
	verticalScrollPolicy="off" horizontalScrollPolicy="off" xmlns:Data="Data.*">
	
	<mx:Script>
		<![CDATA[
			import Data.Globales;
			import Data.Utils;
			import mx.controls.Alert;
			import mx.core.Application;
			import mx.effects.easing.Elastic;	
			import mx.events.ValidationResultEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.soap.WebService;
			import mx.utils.ObjectUtil;
			import mx.validators.Validator;
			
			public var wsMS:WebService;
			public var titulo:String;
			private var du:Utils;
			private var global:Globales;
			
			//funcion que ejecuta el proceso de modificacion de tasa de interes
			public function ejecuta():void{
				if(valida()){
					initConexion();
					du.sCursor();
					global.bloquear();
					
					var codigo:String = txtCodigo.text;
					var ciclo:String = txtCiclo.text;
					var tasa:String = txtTasa.text;
					
					du.ejecutaWsMethod(wsMS,function(evt:ResultEvent):void {											
						var res:String = evt.result.toString();
						
						du.rCursor();
						du.closeWs(wsMS);
						global.desbloquear();
						
						if(res.substr(0,1) == "1"){
							limpiar();
							du.mostrarMensaje("Modificación realizada exitosamente.",titulo,4,null,null,global.iInfo);
						}
						else
							du.mostrarMensaje(res.substr(2, res.length),titulo,4,null,null,global.iAlert);		
					});
					wsMS.setAccionModTasaInt.send(codigo, ciclo, "I", tasa, global.obtenerUsuario());
				}
			}
						
			public function initApp():void{
				global = new Globales();
				du = new Utils();
				titulo = "Modificación de Tasa de Interés";
				lblTitulo.text = titulo.toUpperCase();
				limpiar();
			}		
			
			private function initConexion():void{				
				wsMS = new WebService();			
				wsMS.wsdl = Application.application.wsStr.wsdlServ.toString();
				wsMS.loadWSDL();
			}	
		
			private function limpiar():void{
				txtCodigo.text = "";
				txtCiclo.text = "";
				txtTasa.text = "";
				txtCodigo.setFocus();
			}
				
			private function valida():Boolean{
				if(txtCodigo.text == ""){
					du.mostrarMensaje("Capture el código de grupo.",titulo,4,null,null,global.iAlert);
					return false;
				}
				if(txtCiclo.text == ""){
					du.mostrarMensaje("Capture el ciclo del préstamo.",titulo,4,null,null,global.iAlert);
					return false;
				}
				if(txtTasa.text == ""){
					du.mostrarMensaje("Debe capturar la nueva tasa de interés.",titulo,4,null,null,global.iAlert);
					return false;
				}
				return true;
			}
			
			private function validarMonto(event:Event):void{
				var vResult:ValidationResultEvent;
				
				numVal.source = TextInput(event.currentTarget);
				vResult = numVal.validate();

				if (vResult.type!=ValidationResultEvent.VALID)
               		TextInput(event.currentTarget).text = "";
			}
		]]>
	</mx:Script>
	<mx:NumberValidator id="numVal" property="text" precision="8" required="false"
        allowNegative="true" domain="real" decimalSeparator="." thousandsSeparator=","/>
	
	<mx:Label id="lblTitulo" x="16.5" y="10" width="247" fontSize="12" fontWeight="bold" fontStyle="italic"/>
	<mx:Label x="16.55" y="39" text="Parámetros" id="lblParam"/>
	<mx:Canvas x="16.55" y="58.5" width="247.54999" height="45.5" styleName="canvasMod" id="cnvPrestamo">
		<mx:Label id="lblCiclo" x="145.25" y="11" text="Ciclo:" height="20" textAlign="right"/>
		<mx:Label id="lblGrupo" x="16.25" y="11" text="Código:" height="20" textAlign="right"/>
		<mx:TextInput id="txtCodigo" x="65.25" y="10" maxChars="6" restrict="0-9" width="60"/>
		<mx:TextInput id="txtCiclo" x="184.25" y="10" width="45" maxChars="2" restrict="0-9"/>
	</mx:Canvas>
	<mx:Canvas x="16.5" y="112" width="247.54999" height="45" styleName="canvasMod" id="cnvFecha">
		<mx:Label x="42.25" y="11" text="Tasa de Interés:" id="lblTasa"/>
		<mx:TextInput id="txtTasa" x="133.25" y="10" change="validarMonto(event)" width="80"/>
	</mx:Canvas>
	<mx:Button x="65.3" y="165" label="Aceptar" click="ejecuta()" id="btnAceptar"/>
	<mx:Button x="144.3" y="165" label="Limpiar" click="limpiar()" id="btnLimpiar"/>
</mx:Canvas>